---
title: "Project Web Site Group W"
author: "Jae Woong Ham"
date: "5/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(plotly)
library(RColorBrewer)
library(tibble)
library(lubridate)
```

# Introduction
Our website is primarily split into two portions. For the first part of our visualization, we used various forms of ggplots to demonstrate insightful points for duration and total fare amount of trips. This was done in the form of time series using a combination of aggregation and tailored configuration for each plot. For the second part of our visualization, we used variables that are most suited and ideal to be illustrated on maps for insightful analysis. This was done through leaflet maps with the implementation of aggregated data and custom feature additions.

Please keep in mind that all the graphs are interactive in nature. Instead of focusing a specific variable, our group thought it would be more useful to give user the control to use the already-available insights from the visualization based on his/her individual needs, either in the perspective of the consumer or taxi driver. Our team would also like to point out that all the preprocessing and data scrubbing, as well as exploratory data analysis, are included as part of our process book, and is excluded from this section. This website only includes our final data viusalization outputs, in accordance with the instructions laid out in the class website.

When aggregating data, our team used median for all variables, apart from tip amounts. This was done because the data contained a reasonable of outliers that might skew the average during aggregation. As such, we determined median was the best method to most accurately capture the insights from the data relevant to the variables of interest.

# Time Series Analysis using ggplots

### Analysis of Duration

```{r}
plot1 <- all_months %>%
  group_by(hour) %>%
  summarise(median_duration = median(as.numeric(duration))) %>%
  ggplot(aes(hour, median_duration)) +
  geom_smooth(method="loess", formula=y ~ x) +
  geom_point(color='midnightblue', size=2) +
  labs(title="Duration of Aggregated Trips over 24 Hours", x="Hour (Military Time)", y="Duration (Minutes)") +
  theme_bw()
ggplotly(plot1)
```
From the graph above, the peak rush hour time period is shown to be from 9 a.m. to 6 p.m. with the median duration hovering around 12 minutes, and the duration gradually declines after 6 p.m. The lowest points are around 5 a.m. or 6 a.m.. This is reasonable considering that most people work from 9 a.m. to 6 p.m., and people frequently use cabs throughout the working period in the bustling city of New York.

```{r}
plot2 <- all_months %>%
  group_by(day,hour) %>%
  summarise(median_duration = median(as.numeric(duration))) %>%
  ggplot(aes(x=hour, y=median_duration, group=as.factor(day))) +
  geom_line(aes(color=as.factor(day))) +
  labs(title="Duration of Aggregated Trips over 24 Hours Sorted by Day of Week", x="Hour (Military Time)", y="Duration (Minutes)") +
  guides(color=guide_legend("Day")) +
  theme_bw()
ggplotly(plot2)
```
Our group further dissected the duration over a day by comparing its trends by the day of the week. One can clearly see how weekdays follow a similar trend of following a sharp increase in duration of trips from 7 a.m. to 12 p.m., which is followed by a gradual decline. This effect is similar to the aggregated graph above, but the effect is more pronounced and the rush hour seems to start earlier. However, there is a clear difference in this trend when looking at the weekends; Saturday and Sunday both follow a gradual increase from 7 a.m. to 7 p.m. (Saturday) or 3 p.m. (Sunday). As such, one can clearly see people start their day more slowly on these days.

Note: you can selectively click on a single day by double clicking on the desired day of the week on the legend box of the interactive map. This would apply to any interactive maps with the legend embedded within the graph.


```{r}
plot3 <- all_months %>%
  group_by(day) %>%
  summarise(median_duration = median(as.numeric(duration))) %>%
  ggplot(aes(as.factor(day), median_duration)) +
  geom_point(color='midnightblue', size=2) +
  #geom_bar(stat="identity")+
  labs(title="Duration of Aggregated Trips over Days of Week", x="Day of the Week", y="Duration (Minutes)") +
  theme_bw()
ggplotly(plot3)
```
Now, we shifted gears to study how the duration varies by the day of the week. This almosts seems like a normal distribution curve with Monday and Sunday having the two lowest duration (10.5 and 10 minutes), while Thursday marks the highest peak with around 12 minutes in duration. This trend was also reflected in the overall trend in previous graph when comparing day to day with Thursday having the highest duration on average, while Sunday had the lowest.

```{r}
plot4 <- all_months %>%
  group_by(month,day) %>%
  summarise(median_duration = median(as.numeric(duration))) %>%
  ggplot(aes(x=day, y=median_duration, fill=as.factor(month))) + 
  geom_bar(stat="identity", width=0.7, position=position_dodge()) +
  labs(title="Duration of Aggregated Trips over 24 Hours Sorted by Month", x="Day of Week", y="Duration (Minutes)") +
  guides(color=guide_legend("Month")) +
  theme_bw()
ggplotly(plot4)
```
Our group thought it would also be interesting to analyze the duration of weekdays by month, and compare month to month. It seems like June and October consistently share the highest peak throughout the days of the week, in general. This may be attributed to major holidays (i.e. summer break) or the start of schools (i.e. fall semester for universities), where people tend to travel more than other months of the year. In terms of day to day, thursday seem to have the highest duration of trips over any other day of the week, and Sunday have the lowest. This pattern is consistent with what we saw with the graph above.

